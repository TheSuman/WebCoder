<!DOCTYPE html>
<html>
<head>
    <title>WebCoder - Test your HTML, CSS and JS Codes</title>
    <!-- the three things that jQuery Mobile needs to work -->
    <link rel="stylesheet" href="themes/custom.css" />
    <link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
    <link rel="stylesheet" href="jquery.mobile-1.4.5/jquery.mobile.structure-1.4.5.css" />
    <script src="jquery-1.11.2.js" type="text/javascript"></script>
    <script src="jquery.mobile-1.4.5/jquery.mobile-1.4.5.js" type="text/javascript"></script>
		<!-- Library for Emmet - Zencoding -->
    <script src="emmet.min.js"></script>
		<!-- Library for Toast Messaging -- CFTOASTER -->
   	<link rel="stylesheet" title="default" type="text/css" href="jquery.cftoaster.1.0.1.css"/>	
		<script type="text/javascript" src="jquery.cftoaster.1.0.1.min.js"></script>
    <meta name="viewport" content="width=device-width"/>
		<style>
			 
			textarea {
				font-family: "consolas",monospace;
				font-size: 90%;
				padding: 5px;
			}
			
			#resultFrame {
				position:fixed; 
				top:0px; left:0px; bottom:0px; right:0px; 
				width:100%; 
				height:100%; 
				border:none; 
				margin:0; 
				padding:0; 
				overflow:hidden; 
				z-index:999999; 
				background-color: orange; 
			}
			
	  </style>
</head>
<body>
    <!-- This is the first page -->
    <section id="firstpage" data-role="page" data-theme="d">
        <header data-role="header">
          <h1>WebCoder</h1>
          <a href="#secondpage" id="runButton" class="ui-btn ui-btn-right ui-icon-recycle ui-btn-icon-left ui-corner-all" data-transition="flip">Run</a>
          <a href="#left-panel" data-role="button" data-icon="bars" data-iconpos="notext" class="ui-btn-left">Menu</a>
        </header>
        
         <div class="ui-content">
          <div data-role="collapsible-set"  data-theme="c">
          	<div data-role="collapsible" data-collapsed="false">
          		<h2>HTML</h2>
          		<textarea id="htmlCode" placeholder="Write HTML here"></textarea>
          	</div>
          	<div data-role="collapsible" data-theme="d">
          		<h2>CSS</h2>
          		<textarea id="cssCode" placeholder="Write CSS here"></textarea>
          	</div>
          	<div data-role="collapsible">
          		<h2>JavaScript</h2>
          		<textarea id="jsCode" placeholder="Write JS here"></textarea>
          	</div>
          	
          	<button id="toast" class="ui-btn">Toast</button>
          </div>
        </div>
        
        <footer data-role="footer" data-position="fixed">
        	<h3>This is just some footer content</h3>
        </footer>
        
        <div data-role="panel" id="left-panel" data-display="overlay">
					<ul data-role="listview">
						<li><a href="#libraryDialog" data-transition="flow">Include Coding Libraries</a></li>
						<li><a href="#savingDialog" data-transition="flow">Save Your Code</a></li>
						<li><a href="#openingDialog" data-transition="flow">Open Your Existing Code</a></li>
					</ul>
				</div>
    </section>
    
    <section id="secondpage" data-role="page">
			<header data-role="header">
          <h1>WebCoder</h1>
          <a href="#firstpage" class="ui-btn ui-btn-right ui-icon-home ui-btn-icon-left ui-corner-all" data-transition="flip" data-direction="reverse">Home</a>
      </header>
      <div class="ui-content">
				<iframe id="resultFrame"></iframe>
			</div>
		</section>
		
		<div id="libraryDialog" data-role="page" data-dialog="true" data-close-btn="right" data-theme="d">
        <div data-role="header">
          <h1>Dialog Title</h1>
        </div>
        <div class="ui-content">
          <p>This page contains the dialog content</p>
        </div>
        <div data-role="footer"><h2>Dialog Footer</h2></div>
    </div>
		
		<div id="savingDialog" data-role="page" data-dialog="true" data-close-btn="right" data-theme="c">
        <div data-role="header">
          <h1>Save Your Code</h1>
        </div>
        <div class="ui-content" align='center'>
        	<table>
        		<tr>
        			<td><input type="text" name="" id="inputHTMLfileNameAs" value="" placeholder="Enter HTML File Name"/></td>
        			<td><button class="ui-btn" id="saveHtml">Save HTML</button></td>
        		</tr>
						
						<tr>
							<td><input type="text" name="" id="inputCSSfileNameAs" value="" placeholder="Enter CSS File Name"/></td>
							<td><button class="ui-btn" id="saveCss">Save CSS</button></td>
						</tr>
						
						<tr>
							<td><input type="text" name="" id="inputJSfileNameAs" value="" placeholder="Enter JS File Name"/></td>
							<td><button class="ui-btn" id="saveJs">Save JS</button></td>
						</tr>	
        	</table>
        </div>
    </div>
    
    <div id="openingDialog" data-role="page" data-dialog="true" data-close-btn="right" data-theme="c">
        <div data-role="header">
          <h1>Open Your Code</h1>
        </div>
        <div class="ui-content" align='center'>
          <table>
        		<tr>
        			<td><input type="file" name="" id="openHTML" accept="text/html" /></td>
        			<td><button class="ui-btn" id="loadHtml">Load HTML</button></td>
        		</tr>
						
						<tr>
        			<td><input type="file" name="" id="openCSS" accept="text/css" /></td>
        			<td><button class="ui-btn" id="loadCss">Load CSS</button></td>
        		</tr>
						
						<tr>
        			<td><input type="file" name="" id="openJS" accept="application/javascript" /></td>
        			<td><button class="ui-btn" id="loadJs">Load JS</button></td>
        		</tr>
        	</table>
        </div>
    </div>
    <script>
			
			emmet.require('textarea').setup({
				pretty_break: true, // enable formatted line breaks (when inserting 
			            					// between opening and closing tag) 
				use_tab: true       // expand abbreviations by Tab key
			});
			
			// Swipe to open panel
			$( document ).on( "pageinit", "#firstpage", function() {
				$( document ).on( "swipeleft swiperight", "#firstpage", function( e ) {
					if ( $.mobile.activePage.jqmData( "panel" ) !== "open" ) {
							if ( e.type === "swipeleft"  ) {
									$( "#right-panel" ).panel( "open" );
							} else if ( e.type === "swiperight" ) {
									$( "#left-panel" ).panel( "open" );
							}
					}
				});
			});
			
			$("#runButton").click(function() {
			
					$("iframe").contents().find("html").html('<style>'+$("#cssCode").val()+'</style>'+$("#htmlCode").val());
					document.getElementById("resultFrame").contentWindow.eval($("#jsCode").val());
				
			});
		
			//button to show toast message
			$("#toast").on("click", function(){
				showToastMessage("THis is just a toastmessage");
			});	


			/**
			 * show the toast message by using the string in the text field
			 * @param none
			 */
			function showToastMessage(message) 
			{
				$("body").cftoaster({content: message, showTime: 1500});
			}
			
			function saveTextAsFile(contentID, fileName, category)   // File Saving Function
			{
				var textToWrite = document.getElementById(contentID).value;
				var textFileAsBlob = new Blob([textToWrite], {type:category});
				if ( category == 'application/javascript' ) {
					var fileNameToSaveAs = document.getElementById(fileName).value+".js";
				} else {
					var fileNameToSaveAs = document.getElementById(fileName).value;
				}

				var downloadLink = document.createElement("a");
				downloadLink.download = fileNameToSaveAs;
				downloadLink.innerHTML = "Download File";
				if (window.webkitURL != null)
				{
					// Chrome allows the link to be clicked
					// without actually adding it to the DOM.
					downloadLink.href = window.webkitURL.createObjectURL(textFileAsBlob);
				}
				else
				{
					// Firefox requires the link to be added to the DOM
					// before it can be clicked.
					downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
					downloadLink.onclick = destroyClickedElement;
					downloadLink.style.display = "none";
					document.body.appendChild(downloadLink);
				}

				downloadLink.click();
				if (category == 'text/html') { // inform user about the file saved
					showToastMessage(fileNameToSaveAs+ ".html is saved successfully");
				}
				else if (category == 'text/css') {
					showToastMessage(fileNameToSaveAs+ ".css is saved successfully");
				} else {
					showToastMessage(fileNameToSaveAs+ " is saved successfully");
				}
			}
			
			function destroyClickedElement(event)
			{
				document.body.removeChild(event.target);
			}
			
			
			$("#saveHtml").on("click", function() {     //Saves HTML Code
				saveTextAsFile("htmlCode", "inputHTMLfileNameAs", 'text/html');
			});
			
			$("#saveCss").on("click", function() {     //Saves CSS Code
				saveTextAsFile("cssCode", "inputCSSfileNameAs", 'text/css');
			});
			
			$("#saveJs").on("click", function() {     //Saves JS Code
				saveTextAsFile("jsCode", "inputJSfileNameAs", 'application/javascript');
			});
			
			
			function loadFileAsText(fileID, textareaID)  // File Loading Function
			{
				var fileToLoad = document.getElementById(fileID).files[0];

				var fileReader = new FileReader();
				fileReader.onload = function(fileLoadedEvent) 
				{
					var textFromFileLoaded = fileLoadedEvent.target.result;
					document.getElementById(textareaID).value = textFromFileLoaded;
				};
				fileReader.readAsText(fileToLoad, "UTF-8");
				showToastMessage("Your File is loaded successfully");
				
			}			

			$("#loadHtml").on("click", function() {   //Loads HTML Code
				loadFileAsText("openHTML", "htmlCode"); // parameter: Input File ID, textarea ID
			});
			
			$("#loadCss").on("click", function() {   // Loads CSS Code
				loadFileAsText("openCSS", "cssCode"); // parameter: Input File ID, textarea ID
			});
			
			$("#loadJs").on("click", function() {   // Loads JS Code
					loadFileAsText("openJS", "jsCode"); // parameter: Input File ID, textarea ID
			});	
			
		</script>
</body>
</html>
